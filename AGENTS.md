# PetGame
## **1\) Роль и зона ответственности бота**

* **Главная роль:** превращать требования из GDD/TDD/Production-плана в код Unity 6, сцены, префабы, конфиги и тест-сцены.

* **Приоритеты реализации:**

  1. **Разрушаемое окружение** и боевка (критический путь).

  2. **Сетевой ко-оп** с корректной синхронизацией разрушений.

  3. **Камера и респавн/POW**, читаемость хаоса.

  4. **Оружие/взрывы** по формулам из документа.

  5. **Мета и режимы** (Survival, редактор уровней) — после core.

---

## **2\) Проектная структура и стандарты**

* **Unity 6, 2D URP, Tilemap, 2D Physics.**

**Папки:**

 Assets/\_Project/  
  Art/ (Sprites, Tiles, VFX)  
  Audio/ (SFX, Music)  
  Prefabs/  
  Scenes/ (Dev\_\*, Level\_\*)  
  Scripts/  
    Core/ (Destruction, Damage, Explosion, Materials)  
    Combat/ (Weapons, Projectiles, DoT)  
    Camera/ (Solo, CoopZoom, ScreenDeath)  
    Netcode/ (State, Events, Snapshots)  
    Gameplay/ (POW, Respawn, Checkpoints)  
    UI/  
  Settings/ (Input, Physics2D, URP)

*   
* **Код-стайл:** C\# 10, `PascalCase` для типов, `_camelCase` для приватных полей, `readonly` где возможно.

* **Тестовые сцены:** каждая фича — своя `Dev_*` сцена с минимальным контентом и gizmos.

* **Целевой FPS:** стабильные **60 FPS** при пиковых разрушениях; проверять на «низком» пресете.

---

## **3\) Каноника дизайна, которую бот обязан соблюдать**

* **Core loop:** короткие миссии «беги-и-стреляй» → мини-босс → эвакуация на вертолёт → награда. Спасение **POW** даёт жизнь и мгновенно **переключает на нового героя**. Показывать финальную сцену **«AREA LIBERATED\!»**.

* **Ко-оп до 4 игроков**, friendly-fire **вкл** по умолчанию; риск «хаоса» учитывать в UX.

* **Камера ко-оп:** авто-zoom (≈30 тайлов → до ≈60 при разлёте), границы **1×…0.5×**; если не вмещаются — **«смерть экрана»** с предупреждением.

* **Респавн:** при наличии жизней — быстрый возврат с троса/чекпоинта; если жизней нет — **спасение POW** мгновенно возвращает погибшего.

* **Материалы тайлов:** Земля 3HP; Камень 5HP; Сталь ∞ (неразрушима); Дерево 2HP; Песок/Снег 1HP — с описанным поведением.

* **Взрывы:** линейное затухание урона: `damage = baseDamage * max(0, 1 - dist/Radius)`; примеры для гранаты и РПГ. Учитывать **knockback**.

* **FF-опции:** тумблеры *Off* и *Smoothed (50%)* для пуль; взрывы всегда опасны.

---

## **4\) Алгоритм работы бота над каждой задачей**

1. **Привязать требование к документу:** указать раздел/строки спецификации, по которым действует. (напр., камера/zoom — см. раздел «Управление и камера»).

2. **Сформировать мини-ТЗ «как сделаю»:** перечень скриптов/компонентов, публичные поля, события, сериализуемые параметры, инспекторные пресеты.

3. **Выдать код и сцены:**

   * Полные C\# скрипты с неймингом файлов и путями.

   * Префабы/Tile Palette/ScriptableObjects (описать поля и дефолты).

   * Dev-сцена для проверки.

4. **Протестировать в офлайне:** чек-лист «Definition of Done» (см. п. 5).

5. **Сетевые допуски:** если фича затрагивает состояние мира — описать и реализовать событие/снимок/компенсацию, чтобы **разрушения** и **позиции** были консистентны.

6. **Производительность:** измерить «горячие места», применить object pooling, лимиты одновременных взрывов, оптимизировать удаление тайлов.

7. **Выход артефактов:** diff-лист файлов, короткий «README как запустить», список тюнинг-параметров в Инспекторе, чек-видео/скрин.

---

## **5\) Definition of Done (чек-листы по ключевым подсистемам)**

**A. Разрушения (TilemapDestruction)**

* Материалы и HP соответствуют таблице.

* Взрывы наносят **линейный** урон по радиусу; визуальные круги соответствуют фактическому радиусу.

* Падают «falling blocks» и убивают при раздавливании; есть failsafe выталкивания из тайла.

**B. Оружие/взрывы**

* Настройки гранаты/РПГ валидированы на тест-сцене с грунтом/камнем/сталью.

* Knockback масштабируется по дистанции.

**C. Камера/ко-оп**

* Авто-zoom, границы 1×…0.5×; «смерть экрана» с 3-сек предупреждением.

* Режим соло — упреждение по ходу движения, screen-shake с настройкой.

**D. Респавн/POW**

* Возврат с троса/чекпоинта при наличии жизней.

* POW мгновенно возвращает погибшего.

**E. UX «хаоса» и FF**

* FF включён по умолчанию; тумблеры FF Off/Smoothed работают.

**F. Метрика миссий**

* Петля миссии, «вертолёт» и финальная сценка соблюдены.

---

## **6\) Архитектурные решения (по умолчанию)**

* **DestructionCore:** `TileHealth` (ScriptableObject c HP и типом), `TileChunk` (батч-операции), `ExplosionService` (линейный урон по радиусу \+ импульс), `FallingBlock` (перевод в динамику). Формула урона — как в доке.

* **Combat:** `Weapon` базовый, наследники (Rifle/Shotgun/RPG/Grenade/Others), `Damageable` (интерфейс), `FriendlyFirePolicy` (Off/On/Smoothed).

* **Camera:** `CoopCameraController` (Bounding Box → Zoom), `ScreenDeathGuard` (таймер/стрелка).

* **Respawn/POW:** `LivesPool`, `PowCage`, `RespawnService` (трос/чекпоинт, drop-in).

* **Netcode (абстракция):** события разрушений как id-адресованные операции (tile-ops), периодическая сверка/снапшоты мира.

---

## **7\) Порядок ввода фич (бэклог первого прохода)**

1. **Прото разрушений \+ взрывы** (2 недели, критический путь).

2. **Камера соло/ко-оп \+ «смерть экрана».**

3. **Респавн/POW/чекпоинты.**

4. **Оружие и базовые враги.**

5. **Сетевой слой с синхронизацией разрушений (минимум 2 ПК прототип).**

6. **Вертикальный срез: 1 полированный уровень (к 3-му месяцу).**

---

## **8\) Риски и правила принятия решений**

* Если выбор между скоростью и точностью — **сначала соответствие канону дизайна** (loop/камера/POW/взрывы), затем оптимизация.

* **Онлайн-синхронизация разрушений — высокий риск**: выделять отдельные спринты под проверку на 2 ПК, фиксировать десинхроны.

* **Не копировать чужой IP** (имена/образы); держаться плана дифференциации.

---

## **9\) Что бот отдаёт по итогу каждой задачи**

* Полные C\#-скрипты и пути файлов, `*.prefab`/`*.asset` имена.

* Список добавленных сцен/объектов и как проверить.

* Таблица параметров (HP материалов, радиусы, урон).

* Краткий отчёт об измерениях (кадры, память) и next steps.

